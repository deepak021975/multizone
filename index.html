<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multizone — Winter Collection - Closing Sale</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .fade-in { animation: fadeIn .25s ease-in-out; }
    @keyframes fadeIn { from { opacity:0 } to { opacity:1 } }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- CONFIG - Edit only STORE_CONFIG OR provide products.json / Google Sheet -->
  <script>
    const STORE_CONFIG = {
      storeName: "Multizone",
      currencySymbol: "₹",
      whatsappNumber: "919835185222",
      defaultPrice: 300,
      offer: { anyTwoPrice: 399 },
      products: [],
      gifts: []
    };

    const PUBLIC_SHEET_ID = null; 
  </script>

  <!-- NAV -->
  <nav class="sticky top-0 bg-white shadow z-50">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3 cursor-pointer" onclick="renderProducts()">
        <i class="fas fa-snowflake text-2xl text-indigo-600"></i>
        <div>
          <div id="nav-store-name" class="font-bold text-lg text-indigo-600"></div>
          <div class="text-xs text-gray-500">Lightweight Woolen Collection</div>
        </div>
      </div>
      <div class="relative cursor-pointer" onclick="toggleCart()">
        <i class="fas fa-shopping-cart text-xl text-gray-600 hover:text-indigo-600"></i>
        <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="bg-indigo-700 text-white py-12">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-5xl font-bold">Winter Collection — Closing Sale</h1>
      <p class="mt-3 text-indigo-100">All items ₹300 | Offer: Buy any 2 for ₹399 + choose a free gift</p>
      <div class="mt-6">
        <button onclick="document.getElementById('products-section').scrollIntoView({behavior:'smooth'})" class="bg-white text-indigo-700 px-6 py-3 rounded-full font-semibold shadow">
          Shop Now
        </button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main id="products-section" class="container mx-auto px-4 py-10">
    <div id="category-filters" class="flex flex-wrap gap-2 mb-6"></div>
    <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>

  <!-- CART PANEL -->
  <div id="cart-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-40" onclick="toggleCart()"></div>
    <div id="cart-panel" class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-xl translate-x-full transition-transform">
      <div class="p-4 border-b flex justify-between items-center">
        <h2 class="font-bold text-lg"><i class="fas fa-shopping-bag mr-2"></i>Your Cart</h2>
        <button onclick="toggleCart()" class="text-2xl">&times;</button>
      </div>
      <div id="cart-items" class="p-4 space-y-4 overflow-y-auto min-h-[200px]"></div>

      <div class="p-4 border-t">
        <div class="flex justify-between items-center mb-3">
          <div class="text-sm text-gray-600">Subtotal</div>
          <div id="cart-subtotal" class="font-bold"></div>
        </div>
        <div class="flex justify-between items-center mb-3">
          <div class="text-sm text-gray-600">Offer Discount</div>
          <div id="cart-offer" class="font-bold text-indigo-600"></div>
        </div>
        <div class="flex justify-between items-center mb-4">
          <div class="text-lg font-bold">Total</div>
          <div id="cart-total" class="text-lg font-bold"></div>
        </div>
        <button id="checkout-btn" onclick="showCheckout()" class="w-full bg-indigo-700 text-white py-3 rounded disabled:opacity-60" disabled>
          Checkout via WhatsApp
        </button>
      </div>
    </div>
  </div>

  <!-- CHECKOUT -->
  <div id="checkout-modal" class="fixed inset-0 z-60 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black bg-opacity-50" onclick="hideCheckout()"></div>
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl relative overflow-hidden fade-in">
      <div class="bg-indigo-700 p-4 text-white">
        <h3 class="text-lg font-bold">Delivery & Free Gift Selection</h3>
      </div>
      <div class="p-6">
        <form id="order-form" onsubmit="processOrder(event)">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium">Full name</label>
              <input id="cust-name" required class="mt-1 w-full border px-3 py-2 rounded" placeholder="Your name">
            </div>
            <div>
              <label class="text-sm font-medium">Phone number</label>
              <input id="cust-phone" required class="mt-1 w-full border px-3 py-2 rounded" placeholder="+91 9xxxxxxxxx">
            </div>
            <div class="md:col-span-2">
              <label class="text-sm font-medium">Delivery address</label>
              <textarea id="cust-address" required class="mt-1 w-full border px-3 py-2 rounded" rows="3" placeholder="Street, city, pin code..."></textarea>
            </div>
          </div>

          <div class="mt-6">
            <div class="text-sm text-gray-600 mb-2">Free gift (available only with 2+ items):</div>
            <div id="gift-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
          </div>

          <div class="mt-6 flex gap-3">
            <button type="button" onclick="hideCheckout()" class="flex-1 px-4 py-2 border rounded">Cancel</button>
            <button type="submit" class="flex-1 px-4 py-2 bg-green-500 text-white rounded flex items-center justify-center gap-2">
              <i class="fab fa-whatsapp text-lg"></i> Place Order
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="fixed bottom-6 right-6 bg-gray-800 text-white px-5 py-3 rounded shadow transform translate-y-20 transition-all">
    Added
  </div>

  <!-- JAVASCRIPT LOGIC -->
  <script>
    let cart = JSON.parse(localStorage.getItem('myShopCart')) || [];
    document.getElementById('nav-store-name').textContent = STORE_CONFIG.storeName;

    /* PRODUCT LOADER */
    (async function loadProducts(){
      try {
        const r = await fetch('products.json', {cache: "no-store"});
        if (r.ok) {
          const data = await r.json();
          STORE_CONFIG.products = data;
          init();
          return;
        }
      } catch(e){}

      init();
    })();

    function init(){
      renderCategories();
      renderProducts();
      updateCartUI();
      renderGiftOptions();
    }

    function renderCategories(){
      const container = document.getElementById('category-filters');
      const cats = ['All', ...new Set(STORE_CONFIG.products.map(p=>p.category))];
      container.innerHTML = cats.map(c =>
        `<button onclick="renderProducts('${c}')" class="px-4 py-2 rounded-full bg-white border text-sm">${c}</button>`
      ).join('');
    }

    function renderProducts(category='All'){
      const grid = document.getElementById('product-grid');
      const list = category === 'All'
        ? STORE_CONFIG.products
        : STORE_CONFIG.products.filter(p=>p.category===category);

      if (!list.length){
        grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-10">No products yet.</div>`;
        return;
      }

      grid.innerHTML = list.map(product => `
        <div class="bg-white rounded-lg overflow-hidden shadow flex flex-col">
          <div class="h-56 bg-gray-100">
            <img src="${product.image}" class="w-full h-full object-cover"/>
          </div>
          <div class="p-4 flex flex-col flex-1">
            <div class="text-xs text-indigo-600 font-semibold">${product.category}</div>
            <h3 class="text-lg font-bold mt-1">${product.name}</h3>
            <p class="text-sm text-gray-500 mt-2 line-clamp-3">${product.description || ""}</p>

            <div class="mt-auto pt-4 flex items-center justify-between">
              <div class="text-xl font-bold">${STORE_CONFIG.currencySymbol}${product.price}</div>
              <button onclick="addToCart(${product.id})" class="bg-indigo-600 text-white px-3 py-2 rounded">Add</button>
            </div>

            <div class="mt-2 text-xs text-gray-500">Offer: Any 2 for ₹399</div>
          </div>
        </div>
      `).join('');
    }

    /* CART LOGIC */
    function addToCart(id){
      const p = STORE_CONFIG.products.find(x=>x.id===id);
      if(!p) return;
      const ex = cart.find(c=>c.id===id);
      if(ex) ex.quantity++;
      else cart.push({...p, quantity:1});
      saveCart(); updateCartUI(); showToast("Added to cart"); toggleCart(true);
    }

    function removeFromCart(id){ cart = cart.filter(i=>i.id!==id); saveCart(); updateCartUI(); }

    function updateQuantity(id, delta){
      const item = cart.find(i=>i.id===id);
      if(!item) return;
      item.quantity += delta;
      if(item.quantity <= 0) removeFromCart(id);
      else { saveCart(); updateCartUI(); }
    }

    function saveCart(){ localStorage.setItem('myShopCart', JSON.stringify(cart)); }

    function calculateTotals(){
      const units = [];
      cart.forEach(i=>{ for(let x=0;x<i.quantity;x++) units.push(i.price); });

      const subtotal = units.reduce((a,b)=>a+b,0);
      const qty = units.length;

      const pair = Math.floor(qty/2);
      const rem = qty % 2;

      const offerTotal = pair * STORE_CONFIG.offer.anyTwoPrice + rem * STORE_CONFIG.defaultPrice;
      const discount = subtotal - offerTotal;

      return {subtotal, qty, offerTotal, discount};
    }

    function updateCartUI(){
      const cartItems = document.getElementById('cart-items');
      const cartCount = document.getElementById('cart-count');
      const sub = document.getElementById('cart-subtotal');
      const off = document.getElementById('cart-offer');
      const tot = document.getElementById('cart-total');
      const checkoutBtn = document.getElementById('checkout-btn');

      const qty = cart.reduce((s,i)=>s+i.quantity,0);
      cartCount.textContent = qty;
      cartCount.classList.toggle('hidden', qty === 0);

      if(!qty){
        cartItems.innerHTML = `<div class="text-center text-gray-400 p-10">Your cart is empty.</div>`;
        sub.textContent = "₹0";
        off.textContent = "₹0";
        tot.textContent = "₹0";
        checkoutBtn.disabled = true;
        return;
      }

      cartItems.innerHTML = cart.map(i => `
        <div class="flex gap-3 bg-white p-3 rounded border">
          <img src="${i.image}" class="w-16 h-16 object-cover rounded"/>
          <div class="flex-1">
            <div class="font-semibold text-sm">${i.name}</div>
            <div class="text-xs text-gray-600">₹${i.price}</div>
            <div class="flex items-center gap-2 mt-2">
              <button onclick="updateQuantity(${i.id}, -1)" class="px-2 bg-gray-200 rounded">-</button>
              <span>${i.quantity}</span>
              <button onclick="updateQuantity(${i.id}, 1)" class="px-2 bg-gray-200 rounded">+</button>
            </div>
          </div>
          <button onclick="removeFromCart(${i.id})" class="text-gray-400 hover:text-red-500">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `).join('');

      const t = calculateTotals();
      sub.textContent = `₹${t.subtotal}`;
      off.textContent = `-₹${t.discount}`;
      tot.textContent = `₹${t.offerTotal}`;
      checkoutBtn.disabled = false;
    }

    /* GIFT OPTIONS */
    function renderGiftOptions(){
      const el = document.getElementById('gift-options');
      if(!STORE_CONFIG.gifts.length){
        el.innerHTML = `<div class="text-gray-400 text-sm col-span-full">No gift options added yet.</div>`;
        return;
      }
      el.innerHTML = STORE_CONFIG.gifts.map(g => `
        <label class="cursor-pointer border rounded p-2 flex flex-col items-center">
          <input type="radio" name="gift" value="${g.id}" class="hidden">
          <img src="${g.image}" class="w-24 h-24 object-cover rounded mb-2"/>
          <div class="text-sm">${g.name}</div>
        </label>
      `).join('');
    }

    /* CHECKOUT */
    function showCheckout(){ toggleCart(); document.getElementById('checkout-modal').classList.remove('hidden'); }
    function hideCheckout(){ document.getElementById('checkout-modal').classList.add('hidden'); }

    function showToast(msg){
      const t=document.getElementById('toast');
      t.textContent=msg;
      t.classList.remove('translate-y-20');
      setTimeout(()=>t.classList.add('translate-y-20'),2000);
    }

    function toggleCart(forceOpen=false){
      const m=document.getElementById('cart-modal');
      const p=document.getElementById('cart-panel');
      if(forceOpen || m.classList.contains('hidden')){
        m.classList.remove('hidden');
        setTimeout(()=>p.classList.remove('translate-x-full'),10);
      } else {
        p.classList.add('translate-x-full');
        setTimeout(()=>m.classList.add('hidden'),300);
      }
    }

    function processOrder(e){
      e.preventDefault();
      const name=document.getElementById('cust-name').value;
      const phone=document.getElementById('cust-phone').value;
      const addr=document.getElementById('cust-address').value;

      const totals=calculateTotals();

      let msg = `*New Order — ${STORE_CONFIG.storeName}*\n`;
      msg+=`\n*Customer:* ${name}`;
      msg+=`\n*Phone:* ${phone}`;
      msg+=`\n*Address:* ${addr}`;
      msg+=`\n\n*Items:*`;

      cart.forEach(i=>{
        msg+=`\n• ${i.name} x${i.quantity} - ₹${i.price}`;
      });

      msg+=`\n\n*Total Items:* ${totals.qty}`;
      msg+=`\n*Subtotal:* ₹${totals.subtotal}`;
      msg+=`\n*Discount:* ₹${totals.discount}`;
      msg+=`\n*Total Payable:* ₹${totals.offerTotal}`;

      const wa = encodeURIComponent(msg);
      window.open(`https://wa.me/${STORE_CONFIG.whatsappNumber}?text=${wa}`, "_blank");

      cart=[];
      saveCart();
      updateCartUI();
      hideCheckout();
    }
  </script>

  <footer class="bg-white border-t mt-10">
    <div class="container mx-auto px-4 py-6 text-sm text-gray-600">
      <div>© <span id="year"></span> Multizone</div>
      <div class="mt-1">Need help? Chat on WhatsApp.</div>
    </div>
  </footer>

  <script>document.getElementById("year").textContent = new Date().getFullYear();</script>

</body>
</html>

